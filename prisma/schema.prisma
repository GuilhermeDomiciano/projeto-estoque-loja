// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Usuario {
  id      String   @id @default(cuid())
  nome    String
  login   String
  senha   String
  empresas Empresa[] // Relacionamento com empresas
  UsuarioEmpresa UsuarioEmpresa[]
}

model Cargo{
  id    String   @id @default(cuid())
  nome  String
  descricao String
  usuarios UsuarioEmpresa[]
}

model UsuarioEmpresa{
  id        String   @id @default(cuid())
  usuario_id String
  empresa_id String
  cargo_id   String
  usuario    Usuario @relation(fields: [usuario_id], references: [id])
  empresa    Empresa @relation(fields: [empresa_id], references: [id])
  cargo      Cargo   @relation(fields: [cargo_id], references: [id])
}

model Cliente {
  id       String  @id @default(cuid())
  email    String? @unique // Permitir nulo
  nome     String
  telefone String? // Permitir nulo
  pedidos  Pedido[]
}


model Empresa {
  id           String   @id @default(cuid())
  cnpj         String?  @unique // Permitir nulo
  razao_social String
  telefone     String?  // Permitir nulo
  produtos     Produto[]
  pedidos      Pedido[]
  kits         Kit[]
  usuarios     Usuario[] 
  usuarioEmpresa UsuarioEmpresa[]
}

model Marca {
  id       String   @id @default(cuid())
  nome     String
  produtos Produto[]
}

model Tipos_variacao {
  id        String      @id @default(cuid())
  nome      String
  descricao String?     // Permitir nulo
  variacoes Variacao[]
}

model Produto {
  id         String      @id @default(cuid())
  descricao  String?     // Permitir nulo
  marca_id   String
  empresa_id String
  marca      Marca       @relation(fields: [marca_id], references: [id])
  empresa    Empresa     @relation(fields: [empresa_id], references: [id])
  variacoes  Variacao[]
  itens_kits Itens_kit[]
}

model Variacao {
  id               String        @id @default(cuid())
  tipo_variacao_id String
  produto_id       String
  tipo_variacao    Tipos_variacao @relation(fields: [tipo_variacao_id], references: [id])
  produto          Produto        @relation(fields: [produto_id], references: [id])
  itens_lotes      Itens_lote[]
  itens_pedidos    Itens_pedido[]
  Lote             Lote[]
  Itens_kit        Itens_kit[]
}

model Lote {
  id          String     @id @default(cuid())
  codigo      Int        // Adicionar código de barras
  validade    DateTime?  // Adicionar data de validade (pode ser nulo)
  itens       Itens_lote[]

  Variacao Variacao[]

  Itens_pedido Itens_pedido[]
}

model Itens_lote {
  id            String   @id @default(cuid())
  variacao_id   String
  lote_id       String
  qt            Int
  preco_compra  Decimal  // Adicionar preço de compra
  preco_venda   Decimal  // Adicionar preço de venda
  variacao      Variacao @relation(fields: [variacao_id], references: [id])
  lote          Lote     @relation(fields: [lote_id], references: [id])
}

model Formas_pagamento {
  id      String     @id @default(cuid())
  nome    String
  cor     String?    // Permitir nulo
  icone   String?    // Permitir nulo
  pedidos Pedido[]
}

model Pedido {
  id                 String           @id @default(cuid())
  valor_total        Decimal
  qt_total           Int
  forma_pagamento_id String
  status_id          String
  cliente_id         String?          // Permitir nulo
  empresa_id         String
  status             Status           @relation(fields: [status_id], references: [id])
  forma_pagamento    Formas_pagamento @relation(fields: [forma_pagamento_id], references: [id])
  cliente            Cliente?         @relation(fields: [cliente_id], references: [id])
  empresa            Empresa          @relation(fields: [empresa_id], references: [id])
  itens_pedidos      Itens_pedido[]
}

model Itens_pedido {
  id          String     @id @default(cuid())
  qt          Int
  valor       Decimal
  pedido_id   String
  lote_id     String?     // Adicionar lote (pode ser nulo)
  kit_id      String?     // Adicionar kit (pode ser nulo)
  pedido      Pedido      @relation(fields: [pedido_id], references: [id])
  lote        Lote?       @relation(fields: [lote_id], references: [id])
  kit         Kit?        @relation(fields: [kit_id], references: [id])
  Variacao Variacao[]

}

model Kit {
  id         String     @id @default(cuid())
  valor      Decimal
  descricao  String?    // Permitir nulo
  empresa_id String
  empresa    Empresa    @relation(fields: [empresa_id], references: [id])
  Itens_kit  Itens_kit[]
  Itens_pedido Itens_pedido[]

}

model Itens_kit {
  id          String     @id @default(cuid())
  qt          Int
  kit_id      String
  variacao_id String
  kit         Kit        @relation(fields: [kit_id], references: [id])
  variacao    Variacao   @relation(fields: [variacao_id], references: [id])
  Produto Produto[]

}

model Status {
  id        String     @id @default(cuid())
  nome      String
  descricao String?    // Permitir nulo
  cor       String?    // Permitir nulo
  pedidos   Pedido[]
}