// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id             Int      @id @default(autoincrement())
  nome           String
  login          String
  senha          String
  empresas       Empresa[]
  usuarioEmpresa UsuarioEmpresa[]
}

model Cargo {
  id          Int      @id @default(autoincrement())
  nome        String
  descricao   String
  usuarios    UsuarioEmpresa[]
}

model UsuarioEmpresa {
  id          Int      @id @default(autoincrement())
  usuario_id  Int
  empresa_id  Int
  cargo_id    Int
  usuario     Usuario @relation(fields: [usuario_id], references: [id])
  empresa     Empresa @relation(fields: [empresa_id], references: [id])
  cargo       Cargo   @relation(fields: [cargo_id], references: [id])
}

model Cliente {
  id       Int     @id @default(autoincrement())
  email    String? @unique // Permitir nulo
  nome     String
  telefone String? // Permitir nulo
  pedidos  Pedido[]
}

model Empresa {
  id             Int      @id @default(autoincrement())
  cnpj           String?  @unique // Permitir nulo
  razao_social   String
  telefone       String?  // Permitir nulo
  produtos       Produto[]
  pedidos        Pedido[]
  kits           Kit[]
  usuarios       Usuario[]
  usuarioEmpresa UsuarioEmpresa[]
}

model Marca {
  id       Int      @id @default(autoincrement())
  nome     String
  produtos Produto[]
}

model Tipos_variacao {
  id        Int        @id @default(autoincrement())
  nome      String
  descricao String?    // Permitir nulo
  variacoes Variacao[]
}

model Produto {
  id         Int        @id @default(autoincrement())
  descricao  String?    // Permitir nulo
  marca_id   Int
  empresa_id Int
  marca      Marca      @relation(fields: [marca_id], references: [id])
  empresa    Empresa    @relation(fields: [empresa_id], references: [id])
  variacoes  Variacao[]
  itens_kits Itens_kit[]
}

model Variacao {
  id               Int           @id @default(autoincrement())
  tipo_variacao_id Int
  produto_id       Int
  tipo_variacao    Tipos_variacao @relation(fields: [tipo_variacao_id], references: [id])
  produto          Produto        @relation(fields: [produto_id], references: [id])
  itens_lotes      Itens_lote[]
  itens_pedidos    Itens_pedido[]
  Lote             Lote[]
  Itens_kit        Itens_kit[]
}

model Lote {
  id          Int        @id @default(autoincrement())
  codigo      Int        // Adicionar código de barras
  validade    DateTime?  // Adicionar data de validade (pode ser nulo)
  itens       Itens_lote[]
  Variacao    Variacao[]
  Itens_pedido Itens_pedido[]
}

model Itens_lote {
  id            Int      @id @default(autoincrement())
  variacao_id   Int
  lote_id       Int
  qt            Int
  preco_compra  Decimal  // Adicionar preço de compra
  preco_venda   Decimal  // Adicionar preço de venda
  variacao      Variacao @relation(fields: [variacao_id], references: [id])
  lote          Lote     @relation(fields: [lote_id], references: [id])
}

model Formas_pagamento {
  id      Int       @id @default(autoincrement())
  nome    String
  cor     String?   // Permitir nulo
  icone   String?   // Permitir nulo
  pedidos Pedido[]
}

model Pedido {
  id                 Int              @id @default(autoincrement())
  valor_total        Decimal
  qt_total           Int
  forma_pagamento_id Int
  status_id          Int
  cliente_id         Int?             // Permitir nulo
  empresa_id         Int
  status             Status           @relation(fields: [status_id], references: [id])
  forma_pagamento    Formas_pagamento @relation(fields: [forma_pagamento_id], references: [id])
  cliente            Cliente?         @relation(fields: [cliente_id], references: [id])
  empresa            Empresa          @relation(fields: [empresa_id], references: [id])
  itens_pedidos      Itens_pedido[]
}

model Itens_pedido {
  id          Int       @id @default(autoincrement())
  qt          Int
  valor       Decimal
  pedido_id   Int
  lote_id     Int?      // Adicionar lote (pode ser nulo)
  kit_id      Int?      // Adicionar kit (pode ser nulo)
  pedido      Pedido    @relation(fields: [pedido_id], references: [id])
  lote        Lote?     @relation(fields: [lote_id], references: [id])
  kit         Kit?      @relation(fields: [kit_id], references: [id])
  Variacao    Variacao[]
}

model Kit {
  id           Int       @id @default(autoincrement())
  valor        Decimal
  descricao    String?   // Permitir nulo
  empresa_id   Int
  empresa      Empresa   @relation(fields: [empresa_id], references: [id])
  Itens_kit    Itens_kit[]
  Itens_pedido Itens_pedido[]
}

model Itens_kit {
  id          Int       @id @default(autoincrement())
  qt          Int
  kit_id      Int
  variacao_id Int
  kit         Kit       @relation(fields: [kit_id], references: [id])
  variacao    Variacao  @relation(fields: [variacao_id], references: [id])
  Produto     Produto[]
}

model Status {
  id        Int       @id @default(autoincrement())
  nome      String
  descricao String?   // Permitir nulo
  cor       String?   // Permitir nulo
  pedidos   Pedido[]
}
